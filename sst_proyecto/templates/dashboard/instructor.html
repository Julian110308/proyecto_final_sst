{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard Instructor - Sistema SST{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item active">Dashboard Instructor</li>
{% endblock %}

{% block content %}
<!-- Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h3 fw-bold text-dark mb-1">
            <i class="bi bi-person-video3 text-primary me-2"></i>
            Panel de Instructor - {{ user.get_full_name|default:user.username }}
        </h1>
        <p class="text-muted mb-0">Gesti√≥n y supervisi√≥n de aprendices</p>
    </div>
    <div class="btn-group">
        <button class="btn btn-primary" onclick="window.location.href='/reportes/'">
            <i class="bi bi-file-earmark-bar-graph me-1"></i>Generar Reporte
        </button>
        <!-- ‚ùå ELIMINADO: Registrar Visitante -->
        <button class="btn btn-outline-success" onclick="programarCapacitacion()">
            <i class="bi bi-calendar-plus me-1"></i>Programar Capacitaci√≥n
        </button>
    </div>
</div>

<!-- M√©tricas Principales -->
<div class="row g-4 mb-4">
    {% include 'components/metric-card.html' with label="Mis Aprendices" value=total_aprendices|default:45 sublabel="A mi cargo" sublabel_icon="bi bi-people-fill" sublabel_color="success" icon="bi-people-fill" icon_color="success" %}

    {% include 'components/metric-card.html' with label="Presentes Hoy" value=aprendices_presentes|default:42 sublabel="93% asistencia" sublabel_color="success" icon="bi-person-check-fill" icon_color="primary" %}

    {% include 'components/metric-card.html' with label="Capacitaciones" value="3" sublabel="1 programada" sublabel_color="warning" icon="bi-mortarboard" icon_color="warning" %}

    {% include 'components/metric-card.html' with label="Reportes Pendientes" value=reportes_pendientes|default:2 sublabel="Por revisar" sublabel_icon="bi bi-file-earmark-text" sublabel_color="warning" icon="bi-file-earmark-text" icon_color="warning" %}
</div>

<!-- Gr√°fico de Asistencia y Acciones R√°pidas -->
<div class="row g-4 mb-4">
    <div class="col-lg-8">
        <div class="card card-modern">
            <div class="card-header-modern">
                <div class="d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">
                        <i class="bi bi-bar-chart-line me-2"></i>
                        Asistencia Semanal de Mis Aprendices
                    </h6>
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-secondary active">Semana</button>
                        <button class="btn btn-outline-secondary">Mes</button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <canvas id="asistenciaChart" height="80"></canvas>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="card card-modern">
            <div class="card-header-modern">
                <h6 class="mb-0">
                    <i class="bi bi-lightning-charge-fill me-2"></i>
                    Acciones R√°pidas
                </h6>
            </div>
            <div class="card-body">
                <div class="d-grid gap-3">
                    <button class="btn btn-outline-primary text-start" onclick="verAprendices()">
                        <i class="bi bi-people me-2"></i>
                        Ver Mis Aprendices
                    </button>
                    <button class="btn btn-outline-success text-start" onclick="registrarAsistencia()">
                        <i class="bi bi-check-circle me-2"></i>
                        Registrar Asistencia
                    </button>
                    <!-- ‚úÖ NUEVO: Programar Capacitaci√≥n -->
                    <button class="btn btn-outline-warning text-start" onclick="programarCapacitacion()">
                        <i class="bi bi-calendar-plus me-2"></i>
                        Programar Capacitaci√≥n
                    </button>
                    <button class="btn btn-outline-info text-start" onclick="window.location.href='/mapas/'">
                        <i class="bi bi-map me-2"></i>
                        Ver Mapa del Centro
                    </button>
                    <button class="btn btn-outline-secondary text-start" onclick="generarReporte()">
                        <i class="bi bi-file-earmark-bar-graph me-2"></i>
                        Generar Reporte
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Mis Aprendices y Capacitaciones -->
<div class="row g-4 mb-4">
    <div class="col-lg-7">
        <div class="card card-modern">
            <div class="card-header-modern d-flex justify-content-between align-items-center">
                <h6 class="mb-0">
                    <i class="bi bi-people me-2"></i>
                    Mis Aprendices (Presentes Hoy)
                </h6>
                <button class="btn btn-sm btn-outline-primary" onclick="verAprendices()">
                    Ver Todos
                </button>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Aprendiz</th>
                                <th>Ficha</th>
                                <th>Entrada</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="avatar bg-primary text-white rounded-circle me-2" style="width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;">
                                            JP
                                        </div>
                                        <span>Juan P√©rez G√≥mez</span>
                                    </div>
                                </td>
                                <td>2543891</td>
                                <td>7:05 AM</td>
                                <td><span class="badge bg-success">Presente</span></td>
                                <td>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="verDetalle('Juan P√©rez')">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="avatar bg-info text-white rounded-circle me-2" style="width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;">
                                            MR
                                        </div>
                                        <span>Mar√≠a Rodr√≠guez</span>
                                    </div>
                                </td>
                                <td>2543891</td>
                                <td>7:12 AM</td>
                                <td><span class="badge bg-success">Presente</span></td>
                                <td>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="verDetalle('Mar√≠a Rodr√≠guez')">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="avatar bg-success text-white rounded-circle me-2" style="width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;">
                                            CL
                                        </div>
                                        <span>Carlos L√≥pez Silva</span>
                                    </div>
                                </td>
                                <td>2543892</td>
                                <td>7:08 AM</td>
                                <td><span class="badge bg-success">Presente</span></td>
                                <td>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="verDetalle('Carlos L√≥pez')">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="avatar bg-warning text-white rounded-circle me-2" style="width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;">
                                            AM
                                        </div>
                                        <span>Ana Mart√≠nez Cruz</span>
                                    </div>
                                </td>
                                <td>2543892</td>
                                <td>7:20 AM</td>
                                <td><span class="badge bg-success">Presente</span></td>
                                <td>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="verDetalle('Ana Mart√≠nez')">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ‚úÖ CAMBIO: Capacitaciones en lugar de Visitantes -->
    <div class="col-lg-5">
        <div class="card card-modern mb-4">
            <div class="card-header-modern d-flex justify-content-between align-items-center">
                <h6 class="mb-0">
                    <i class="bi bi-calendar-check me-2"></i>
                    Mis Capacitaciones SST
                </h6>
                <button class="btn btn-sm btn-primary" onclick="programarCapacitacion()">
                    <i class="bi bi-plus-circle me-1"></i>Nueva
                </button>
            </div>
            <div class="card-body">
                <div class="list-group">
                    <div class="list-group-item">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="mb-1">Primeros Auxilios B√°sicos</h6>
                                <small class="text-muted">Para Ficha 2543891</small>
                                <p class="mb-0 mt-1">
                                    <span class="badge bg-primary">üìÖ Viernes 20/12 - 2:00 PM</span>
                                </p>
                            </div>
                            <span class="badge bg-success">Programada</span>
                        </div>
                    </div>
                    <div class="list-group-item">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="mb-1">Uso de Extintores</h6>
                                <small class="text-muted">Completada el 15/12</small>
                                <p class="mb-0 mt-1">
                                    <small class="text-success">‚úÖ 42 aprendices certificados</small>
                                </p>
                            </div>
                            <span class="badge bg-secondary">Completada</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alertas Importantes -->
        <div class="card card-modern">
            <div class="card-header-modern">
                <h6 class="mb-0">
                    <i class="bi bi-megaphone me-2"></i>
                    Alertas Recientes
                </h6>
            </div>
            <div class="card-body">
                <div class="alert alert-warning mb-3">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    <strong>3 aprendices ausentes</strong><br>
                    <small>Sin justificaci√≥n registrada</small>
                </div>
                <div class="alert alert-info mb-0">
                    <i class="bi bi-info-circle me-2"></i>
                    <strong>Reporte mensual</strong><br>
                    <small>Vence en 3 d√≠as</small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Estad√≠sticas Adicionales -->
<div class="row g-4">
    <div class="col-md-6">
        <div class="card card-modern">
            <div class="card-header-modern">
                <h6 class="mb-0">
                    <i class="bi bi-graph-up me-2"></i>
                    Rendimiento por Ficha
                </h6>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-1">
                        <small>Ficha 2543891</small>
                        <small class="text-success fw-bold">92%</small>
                    </div>
                    <div class="progress" style="height: 8px;">
                        <div class="progress-bar bg-success" style="width: 92%"></div>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-1">
                        <small>Ficha 2543892</small>
                        <small class="text-success fw-bold">88%</small>
                    </div>
                    <div class="progress" style="height: 8px;">
                        <div class="progress-bar bg-success" style="width: 88%"></div>
                    </div>
                </div>
                <div>
                    <div class="d-flex justify-content-between mb-1">
                        <small>Ficha 2543893</small>
                        <small class="text-warning fw-bold">75%</small>
                    </div>
                    <div class="progress" style="height: 8px;">
                        <div class="progress-bar bg-warning" style="width: 75%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card card-modern">
            <div class="card-header-modern">
                <h6 class="mb-0">
                    <i class="bi bi-calendar-week me-2"></i>
                    Resumen Semanal
                </h6>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-6 mb-3">
                        <h4 class="text-success mb-0">93%</h4>
                        <small class="text-muted">Asistencia Promedio</small>
                    </div>
                    <div class="col-6 mb-3">
                        <h4 class="text-primary mb-0">1,120</h4>
                        <small class="text-muted">Horas Totales</small>
                    </div>
                    <div class="col-6">
                        <h4 class="text-warning mb-0">3</h4>
                        <small class="text-muted">Capacitaciones</small>
                    </div>
                    <div class="col-6">
                        <h4 class="text-info mb-0">2</h4>
                        <small class="text-muted">Reportes</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Gr√°fico de asistencia
const ctx = document.getElementById('asistenciaChart');
if (ctx) {
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes'],
            datasets: [{
                label: 'Asistencia (%)',
                data: [95, 92, 88, 96, 93],
                borderColor: '#2e7d32',
                backgroundColor: 'rgba(46, 125, 50, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100,
                    ticks: { callback: value => value + '%' }
                }
            }
        }
    });
}

function verAprendices() {
    alert('Ver todos mis aprendices:\n\n‚úì Lista completa con filtros\n‚úì Estado de asistencia\n‚úì Historial acad√©mico\n‚úì Informaci√≥n de contacto');
}

function registrarAsistencia() {
    alert('Registrar asistencia manual:\n\n‚úì Marcar presentes\n‚úì Registrar ausencias\n‚úì Justificaciones\n‚úì Generar reporte');
}

// ‚úÖ NUEVA FUNCI√ìN
function programarCapacitacion() {
    alert('Programar Capacitaci√≥n SST:\n\nüìö T√≠tulo de la capacitaci√≥n\nüìÖ Fecha y hora\nüë• Aprendices participantes\nüìù Contenido y objetivos\n\nPuedes crear capacitaciones espec√≠ficas para tus fichas.');
}

function verDetalle(nombre) {
    alert(`Ver detalles de ${nombre}:\n\n‚úì Historial completo\n‚úì Asistencia\n‚úì Capacitaciones\n‚úì Datos de contacto`);
}

function generarReporte() {
    window.location.href = '/reportes/';
}
</script>
{% endblock %}